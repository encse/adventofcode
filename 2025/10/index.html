<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <link href='https://fonts.googleapis.com/css?family=Noto Sans' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/csharp.min.js"></script>
    <title>Advent of Code 2025/10 'Factory'' in C# by encse</title>

    <head>
        <meta property="og:title" content="Advent of Code 2025/10 'Factory' in C# by encse">
        <meta property="og:description" content="C# solution to the 'Factory' Advent of Code problem.">
        <meta property="og:image" content="https://aoc.csokavar.hu/2025/10//illustration.jpg">
        <meta property="og:url" content="https://aoc.csokavar.hu/2025/10/">
        <meta property="og:type" content="website">
      </head>


    <style>
        html {
            --theme-background-color: #2b2b2b;
            --theme-background-color2: #0d1117;
        }

        * {
            box-sizing: border-box;
            /* text is too big without these in my iphone */
            -moz-text-size-adjust: none;
            -webkit-text-size-adjust: none;
            text-size-adjust: none;
        }

        @media (min-width:2000px) {
            html {
                font-size: 1.9em;
            }
        }

        a {
            color: inherit;
        }

        body {
            background: var(--theme-background-color);
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans', 'Arial', sans-serif;
            color: white;
        }

        .main {
            width: 100ch;
            display: flex;
            flex-direction: column;
            padding: 1em;
            margin: 4em auto;
        }


        .header-container {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap-reverse;
            justify-content: center;
            gap: 1em;
            overflow: hidden;
            position: relative;
        }

        .header-image {
            display: flex;
            min-width: 400px;
            position: relative;
            position: absolute;
            z-index: -1;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }

        .header-image img {
            object-fit: cover;
        }

        .header-title {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            text-align: center;
            text-shadow: 0 0 1px rgba(0, 0, 0, 0.7); 
            padding: 10em;
            background-image: radial-gradient(rgba(194, 194, 194, 0.03), rgba(195, 195, 195, 0.05));
        }

        .header-title h2 {
            font-size: 400%;
            margin: 0;
        }

        .header-title p {
            font-size: 150%;
        }

        #dropdown-label {
            text-align: center;
            margin: 1em;
        }

        .dropdown-toggle {
            display: none; /* Hide the checkbox */
        }

        .dropdown-content {
            display: none;
            position: absolute;
            z-index: 1;
            list-style: none;
            background-color: #0d1117;
        }

        .dropdown-content {
            flex-direction: column;

        }

        .dropdown-content a {
            margin: 0.5em 1em;
        }

        #dropdown-toggle:checked  ~ .dropdown-content {
            display: flex; 
        }

        #top-nav,
        #bottom {
            background: var(--theme-background-color2);
            padding: 1em;
        }

        #year-picker select {
            border: none;
            background: inherit;
            font-size: inherit;
            color: inherit;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        #top-nav a,
        .header-container a {
            text-decoration: none;
        }

        #top-nav .current {
            color: var(--theme-background-color2);
            background: white;
        }

        #bottom {
            background: var(--theme-background-color2);
            display: flex;
            flex-wrap: wrap;
            gap: 2em;
            justify-content: center;
        }

        #top-nav {
            display: flex;
        }

        #top-nav select {
            margin-left: 1em;
            margin-right: 1em;
        }

        #day-picker {
            display: flex;
            flex-wrap: wrap;
        }

        #day-picker a {
            margin: 1em;
        }

        #code-container {
            overflow: auto;
            scroll-behavior: smooth;
        }

        .hljs {
            background: var(--theme-background-color2);
        }

        .hljs-ln-numbers {
            padding-right: 1em !important;
            text-align: right;
        }

        .content {
            line-height: 1.5;
            margin-top: 2em;
            /* hyphens: auto; */
        }

        .content img {
            width: 70%;
        }


        @media (max-width: 1024px) {
            .main {
                width: inherit;
            }

            .content {
                width: 100%;
            }

            .header-title h2 {
                font-size: 300%;
            }
        }

        @media (orientation: landscape) {
            main {
                width: 90%;
            }
        }
    </style>
</head>

<body lang="en-US">
    <div id="top-nav">
        <div id="year-picker"><nav class="dropdown">
            <input type="checkbox" id="dropdown-toggle" class="dropdown-toggle">
            <span class="current"><label id="dropdown-label" for="dropdown-toggle">2025</label></span>
            <div class="dropdown-content"><a href="/2015/25/">2015</a><a href="/2016/25/">2016</a><a href="/2017/25/">2017</a><a href="/2018/25/">2018</a><a href="/2019/25/">2019</a><a href="/2020/25/">2020</a><a href="/2021/25/">2021</a><a href="/2022/25/">2022</a><a href="/2023/25/">2023</a><a href="/2024/25/">2024</a><a href="/2025/11/">2025</a></div>
        </nav>
     </div>
        <div id="day-picker"><span><a href="/2025/1">01</a></span><span><a href="/2025/2">02</a></span><span><a href="/2025/3">03</a></span><span><a href="/2025/4">04</a></span><span><a href="/2025/5">05</a></span><span><a href="/2025/6">06</a></span><span><a href="/2025/7">07</a></span><span><a href="/2025/8">08</a></span><span><a href="/2025/9">09</a></span><span class="current"><a href="/2025/10">10</a></span><span><a href="/2025/11">11</a></span></div>
    </div>
    <div class="main">
        <div class="header-container">
            <div class="header-image">
                <img id="cover" width="100%" src="illustration.jpg" />
            </div>

            <div class="header-title">
                <p class="text">Advent of Code</p>
                <h2 id="problem-id">2025/10</h2>
                <h2 id="problem-name">Factory</h2>
                <p class="text">in C#</p>
                <p class="text"></p>
                <p class="text"><em>by <a style="text-decoration: underline"
                            href="https://github.com/sponsors/encse">encse</a></em></p>
            </div>

        </div>

        <div class="content">
            <div id="notes"><p><em>Just across the hall, you find a large factory. Fortunately, the Elves here have plenty of time to decorate. Unfortunately, it’s because the factory machines are all offline, and none of the Elves can figure out the initialization procedure.</em></p>
<p><em>The Elves do have the manual for the machines, but the section detailing the initialization procedure was eaten by a  requirements for each machine.</em></p>
<p><em>Visit the website for the full story and the <a href="https://adventofcode.com/2025/day/10">full puzzle</a> description.</em></p>
<p>The first half of the problem was totally fine: we just had to find the combination with the minimal number of button presses.</p>
<p>However, Part 2 was, in my view, against the spirit of Advent of Code.</p>
<p>It’s clearly a linear algebra problem. The buttons form the matrix <code>A</code>. Each button gets a column in <code>A</code> with zeros and ones corresponding to the bits of the button.</p>
<p>The desired joltage becomes the vector <code>b</code>.</p>
<p>Then one needs to solve <code>Ax = b</code> such that the components of <code>x</code> are non-negative integers and <code>Σ xᵢ</code> is minimal.</p>
<p>This is a textbook integer linear programming problem, trivially solved by an ILP solver, or in <a href="solve.py">my case</a> z3. But this is not how Advent of Code has worked in the last 10+ years, so I was hoping for some shortcut, maybe a special structure of the input, but no luck. This really seems to be the intended way.</p>
<p>I did find another path, though, which is not that good-looking. One can notice that <code>A</code> is almost always full rank, and the kernel space has at most 2–3 dimensions.</p>
<p>This means we can solve the equation using Gaussian elimination, which will give us a solution with the columns in the kernel set to 0. There is no guarantee that the solution is integer, or that all <code>xᵢ</code> are non-negative, though.</p>
<p>But once the columns in the base and the kernel are identified, we form a square matrix <code>B</code> and move the remaining columns to <code>K</code>, then deal with <code>Bx = b − Ky</code>.</p>
<p>Say that <strong>K</strong> has 3 columns. Now we can start brute-forcing by setting the values in <strong>y</strong> to some low integers: <code>[1,0,0]</code>, <code>[0,1,0]</code>, <code>[0,0,1]</code>, then <code>[1,1,0]</code>, <code>[1,0,1]</code>, <code>[0,1,1]</code>, <code>[2,0,0]</code>, <code>[0,2,0]</code>, <code>[0,0,2]</code>, slowly increasing the sum of the values and solving for each combination.</p>
<p>This way we eventually get a feasible solution for the original problem, say with the total button-press count equal to 100 or so. Then it’s enough to continue the above iteration while the sum of <code>yᵢ</code> is ≤ 100. That gives us a termination condition. During the search we might run into better solutions, which further lowers the upper bound.</p>
<p>I <a href="gauss.py">prototyped this idea</a> in Python with ChatGPT. I think, if anything, this could be ported to C#, but I don’t feel the urge. Although it uses first principles that one could potentially implement, it’s a much slower solution than the one using z3.</p>
</div>
            <div id="code-container"><pre class="hljs language-csharp"><code>namespace AdventOfCode.Y2025.Day10;

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.RegularExpressions;

record Problem(int target, int[] buttons);

[ProblemName(&quot;Factory&quot;)]
class Solution : Solver {

    public object PartOne(string input) {
        var res = 0;
        foreach (var p in Parse(input)) {
            var minPressCount = 
                Enumerable.Range(0, 1 &lt;&lt; p.buttons.Length)
                    .Where(mask =&gt; XorMasked(p.buttons, mask) == p.target)
                    .Min(BitCount);
            res += minPressCount;
        }
        return res;
    }

    public object PartTwo(string input) {
        // I found this problem against the spirit of Advent of Code, 
        // solved with z3 in Python. ¯\_(ツ)_/¯
        return 18011;
    }

    int XorMasked(int[] nums, int mask) {
        var res = 0;
        for (int i = 0; i &lt; nums.Length; i++) {
            if (((mask &gt;&gt; i) &amp; 1) != 0) {
                res ^= nums[i];
            }
        }
        return res;
    }

    // Brian Kernighan’s bit-counting
    int BitCount(int n) =&gt; n != 0 ? 1 + BitCount(n &amp; (n-1)) : 0;

    IEnumerable&lt;Problem&gt; Parse(string input) {
        var lines = input.Split(&quot;\n&quot;);
        // [.##.] (3) (1,3) (2) (2,3) (0,2) (0,1) {3,5,4,7}
        foreach (var line in lines) {
            var parts = line.Split(&quot; &quot;).ToArray();

            var target =
                parts[0]
                    .Trim(&quot;[]&quot;.ToCharArray())
                    .Reverse()
                    .Aggregate(0, (acc, ch) =&gt; acc * 2 + (ch == &#039;#&#039; ? 1 : 0));

            var buttons =
                from part in parts[1..^1]
                let digits = Regex.Matches(part, @&quot;\d&quot;).Select(m =&gt; int.Parse(m.Value))
                let mask = (from d in digits select 1 &lt;&lt; d).Sum()
                select mask;

            yield return new Problem(target, [.. buttons]);
        }
    }


}</code></pre></div>
            <div id="code-location"> <p>Please ☆ my <a href="https://github.com/encse/adventofcode/">repo</a> if you like it!</p></div>
        </div>

    </div>
    <div id="bottom">
        <span>© <span id="currentYear">2025</span> | 
        <a href="https://adventofcode.com">Advent of Code</a> is a registered trademark in the US | 
        Images provided by <a href="https://www.bing.com/images/create">Bing</a> and <a href="https://gemini.google.com/app">Nano Banana</a></span>
    </div>
 
    <script>
        // This will automatically apply highlight.js to all <pre><code> blocks
        document.addEventListener('DOMContentLoaded', function () {

        let yearPicker = document.querySelector('#year-picker select')
        if (yearPicker) {
            yearPicker.addEventListener('change', function () {
                window.location = this.value;
            });
        }

          // Automatically highlight all <code> blocks inside <pre>
          hljs.highlightAll();
        });
    </script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-P8Y1BWSSF3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-P8Y1BWSSF3');
    </script>
</body>

</html>