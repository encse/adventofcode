<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <link href='https://fonts.googleapis.com/css?family=Noto Sans' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/csharp.min.js"></script>
    <title>Advent of Code 2019/16 'Flawed Frequency Transmission'' in C# by encse</title>

    <head>
        <meta property="og:title" content="Advent of Code 2019/16 'Flawed Frequency Transmission' in C# by encse">
        <meta property="og:description" content="C# solution to the 'Flawed Frequency Transmission' Advent of Code problem.">
        <meta property="og:image" content="https://aoc.csokavar.hu/2019/16//illustration.jpeg">
        <meta property="og:url" content="https://aoc.csokavar.hu/2019/16/">
        <meta property="og:type" content="website">
      </head>


    <style>
        html {
            --theme-background-color: #2b2b2b;
            --theme-background-color2: #0d1117;
        }

        * {
            box-sizing: border-box;
            /* text is too big without these in my iphone */
            -moz-text-size-adjust: none;
            -webkit-text-size-adjust: none;
            text-size-adjust: none;
        }

        @media (min-width:2000px) {
            html {
                font-size: 1.9em;
            }
        }

        a {
            color: inherit;
        }

        body {
            background: var(--theme-background-color);
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans', 'Arial', sans-serif;
            color: white;
        }

        .main {
            width: 100ch;
            display: flex;
            flex-direction: column;
            padding: 1em;
            margin: 4em auto;
        }


        .header-container {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap-reverse;
            justify-content: center;
            gap: 1em;
            overflow: hidden;
            position: relative;
        }

        .header-image {
            display: flex;
            min-width: 400px;
            position: relative;
            position: absolute;
            z-index: -1;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }

        .header-image img {
            object-fit: cover;
        }

        .header-title {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            text-align: center;
            text-shadow: 0 0 1px rgba(0, 0, 0, 0.7); 
            padding: 10em;
            background-image: radial-gradient(rgba(194, 194, 194, 0.13), rgba(195, 195, 195, 0.25));
        }

        .header-title h2 {
            font-size: 400%;
            margin: 0;
        }

        .header-title p {
            font-size: 150%;
        }

        #dropdown-label {
            text-align: center;
            margin: 1em;
        }

        .dropdown-toggle {
            display: none; /* Hide the checkbox */
        }

        .dropdown-content {
            display: none;
            position: absolute;
            z-index: 1;
            list-style: none;
            background-color: #0d1117;
        }

        .dropdown-content {
            flex-direction: column;

        }

        .dropdown-content a {
            margin: 0.5em 1em;
        }

        #dropdown-toggle:checked  ~ .dropdown-content {
            display: flex; 
        }

        #top-nav,
        #bottom {
            background: var(--theme-background-color2);
            padding: 1em;
        }

        #year-picker select {
            border: none;
            background: inherit;
            font-size: inherit;
            color: inherit;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        #top-nav a,
        .header-container a {
            text-decoration: none;
        }

        #top-nav .current {
            color: var(--theme-background-color2);
            background: white;
        }

        #bottom {
            background: var(--theme-background-color2);
            display: flex;
            flex-wrap: wrap;
            gap: 2em;
            justify-content: center;
        }

        #top-nav {
            display: flex;
        }

        #top-nav select {
            margin-left: 1em;
            margin-right: 1em;
        }

        #day-picker {
            display: flex;
            flex-wrap: wrap;
        }

        #day-picker a {
            margin: 1em;
        }

        #code-container {
            overflow: auto;
            scroll-behavior: smooth;
        }

        .hljs {
            background: var(--theme-background-color2);
        }

        .hljs-ln-numbers {
            padding-right: 1em !important;
            text-align: right;
        }

        .content {
            line-height: 1.5;
            margin-top: 2em;
            /* hyphens: auto; */
        }

        .content img {
            width: 70%;
        }


        @media (max-width: 1024px) {
            .main {
                width: inherit;
            }

            .content {
                width: 100%;
            }


            #top-nav span,
            #top-nav .dropdown 
            #top-nav .dropdown-content {
                padding: 0.25em;
            }

            .header-title h2 {
                font-size: 300%;
            }
        }

        @media (orientation: landscape) {
            main {
                width: 90%;
            }
        }
    </style>
</head>

<body lang="en-US">
    <div id="top-nav">
        <div id="year-picker"><nav class="dropdown">
            <input type="checkbox" id="dropdown-toggle" class="dropdown-toggle">
            <span class="current"><label id="dropdown-label" for="dropdown-toggle">2019</label></span>
            <div class="dropdown-content"><a href="/2015/25/">2015</a><a href="/2016/25/">2016</a><a href="/2017/25/">2017</a><a href="/2018/25/">2018</a><a href="/2019/25/">2019</a><a href="/2020/25/">2020</a><a href="/2021/25/">2021</a><a href="/2022/25/">2022</a><a href="/2023/25/">2023</a><a href="/2024/25/">2024</a></div>
        </nav>
     </div>
        <div id="day-picker"><span><a href="/2019/1">01</a></span><span><a href="/2019/2">02</a></span><span><a href="/2019/3">03</a></span><span><a href="/2019/4">04</a></span><span><a href="/2019/5">05</a></span><span><a href="/2019/6">06</a></span><span><a href="/2019/7">07</a></span><span><a href="/2019/8">08</a></span><span><a href="/2019/9">09</a></span><span><a href="/2019/10">10</a></span><span><a href="/2019/11">11</a></span><span><a href="/2019/12">12</a></span><span><a href="/2019/13">13</a></span><span><a href="/2019/14">14</a></span><span><a href="/2019/15">15</a></span><span class="current"><a href="/2019/16">16</a></span><span><a href="/2019/17">17</a></span><span><a href="/2019/18">18</a></span><span><a href="/2019/19">19</a></span><span><a href="/2019/20">20</a></span><span><a href="/2019/21">21</a></span><span><a href="/2019/22">22</a></span><span><a href="/2019/23">23</a></span><span><a href="/2019/24">24</a></span><span><a href="/2019/25">25</a></span></div>
    </div>
    <div class="main">
        <div class="header-container">
            <div class="header-image">
                <img id="cover" width="100%" src="illustration.jpeg" />
            </div>

            <div class="header-title">
                <p class="text">Advent of Code</p>
                <h2 id="problem-id">2019/16</h2>
                <h2 id="problem-name">Flawed Frequency Transmission</h2>
                <p class="text">in C#</p>
                <p class="text"></p>
                <p class="text"><em>by <a style="text-decoration: underline"
                            href="https://github.com/sponsors/encse">encse</a></em></p>
            </div>

        </div>

        <div class="content">
            <div id="notes"><p>You&#39;re 3/4ths of the way through the <a href="https://en.wikipedia.org/wiki/Gas_giant">gas giants</a>. Not only do roundtrip signals to Earth take five hours, but the signal quality is quite bad as well.  You can clean up the signal with the Flawed Frequency Transmission algorithm, or <em>FFT</em>.</p>
<p>As input, FFT takes a list of numbers.  In the signal you received (your puzzle input), each number is a single digit: data like <code>15243</code> represents the sequence <code>1</code>, <code>5</code>, <code>2</code>, <code>4</code>, <code>3</code>.</p>
<p>Read the <a href="https://adventofcode.com/2019/day/16">full puzzle</a>.</p>
</div>
            <div id="code-container"><pre class="hljs language-csharp"><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Numerics;

namespace AdventOfCode.Y2019.Day16;

[ProblemName(&quot;Flawed Frequency Transmission&quot;)]
class Solution : Solver {

    public object PartOne(string input) {

        int[] Fft(int[] digits) {
            IEnumerable&lt;int&gt; Pattern(int digit) {
                var repeat = digit + 1;
                while (true) {
                    foreach (var item in new[] { 0, 1, 0, -1 }) {
                        for (var i = 0; i &lt; repeat; i++) {
                            yield return item;
                        }
                    }
                }
            }

            return (
                from i in Enumerable.Range(0, digits.Length)
                let pattern = Pattern(i).Skip(1)
                let dotProduct = (from p in digits.Zip(pattern) select p.First * p.Second).Sum()
                select Math.Abs(dotProduct) % 10
            ).ToArray();
        }

        var digits = input.Select(ch =&gt; int.Parse(ch.ToString())).ToArray();

        for (var i = 0; i &lt; 100; i++) {
            digits = Fft(digits);
        }

        return string.Join(&quot;&quot;, digits.Take(8));
    }

    public object PartTwo(string input) {
        /* 
            Let&#039;s introduce the following matrix:
                    FFT = [
                        1,  0, -1,  0,  1,  0, -1,  0, ...
                        0,  1,  1,  0,  0, -1, -1,  0, ...
                        0,  0,  1,  1,  1,  0,  0,  0, ...
                        0,  0,  0,  1,  1,  1,  1,  0, ...
                        0,  0,  0,  0,  1,  1,  1,  1, ...
                        0,  0,  0,  0,  0,  1,  1,  1, ...
                        0,  0,  0,  0,  0,  0,  1,  1, ...
                        0,  0,  0,  0,  0,  0,  0,  1, ...
                        ...
                    ]

            A single FFT step of the data stored in vector x is just a matrix multiplication FFT . x
            We get repeated FFT steps with multiplying with the proper power of FFT: FFT^2, FFT^3, ... FFT^100.

            Looking at the FFT matrix, we notice that the bottom right corner is always an upper triangular filled with 1s:
                    A = [
                        1, 1, 1, 1, ...
                        0, 1, 1, 1, ...
                        0, 0, 1, 1, ...
                        0, 0, 0, 1, ...
                        ....
                    ]
            The problem asks for output components that correspond to multiplication with rows in this area.

            Examining A&#039;s powers reveal that the the first row can be:
                the numbers from 1-n, 
                    A^2 = [
                        1, 2, 3, 4, ...
                        0, 1, 2, 3, ...
                        0, 0, 1, 3, ...
                        0, 0, 0, 1, ...
                        ....
                    ]
                the sum of numbers from 1-n
                    A^3 = [
                        1, 3, 6, 10, ...
                        0, 1, 3, 6, ...
                        0, 0, 1, 3, ...
                        0, 0, 0, 1, ...
                        ....
                    ]
                the sum of the sum of numbers from 1-n
                    A^4 = [
                        1, 4, 10, 20, ...
                        0, 1,  4, 10, ...
                        0, 0,  1,  4, ...
                        0, 0,  0,  1, ...
                        ....
                    ]
                etc.
            And we get the second, third... rows with shifting the previous one.

            Using the properties of binomial coefficients we get that the items of the first row of A^k are
                (A^k)_1_j = choose(j - 1 + k - 1, k - 1)

                see https://math.stackexchange.com/questions/234304/sum-of-the-sum-of-the-sum-of-the-first-n-natural-numbers

            and we can compute the items from left to right with
                choose(m + 1, n) = choose(m, n) * (m + 1) / (m + 1 - n)
            
            specifically
                 (A^k)_1_(j + 1) = 
                    choose(j + k - 1, k - 1) = 
                    choose(j - 1 + k - 1, k - 1) * (j + k - 1) / j =
                    (A^k)_1_j * (j + k - 1) / j

            let B = A^100 and so k - 1 = 99.
                B_1_(j + 1) = B_1_j * (j + 99) / j
            and 
                B_i_j = B_1_(j - i + 1)

            we need to compute [B]_{1..7} * xs % 10, where xs is the digits of input repeated 10000 times shifted with t
         */

        var xs = input.Select(ch =&gt; int.Parse(ch.ToString())).ToArray();
        var res = &quot;&quot;;

        var t = int.Parse(input.Substring(0, 7));
        var crow = 8;
        var ccol = input.Length * 10000 - t;

        var bijMods = new int[ccol + 1];
        var bij = new BigInteger(1);
        for (var j = 1; j &lt;= ccol; j++) {
            bijMods[j] = (int)(bij % 10);
            bij = bij * (j + 99) / j;
        }

        for (var i = 1; i &lt;= crow; i++) {
            var s = 0;
            for (var j = i; j &lt;= ccol; j++) {
                var x = xs[(t + j - 1) % input.Length];
                s += x * bijMods[j - i + 1];
            }
            res += (s % 10).ToString();
        }

        return res;
    }

}
</code></pre></div>
            <div id="code-location"> <p>Please ☆ my <a href="https://github.com/encse/adventofcode/">repo</a> if you like it!</p></div>
        </div>

    </div>
    <div id="bottom">
        <span>© <span id="currentYear">2024</span></span>
        <span><a href="https://adventofcode.com">Advent of Code</a> is a registered trademark in the US</span>
        <span>Images provided by <a href="https://www.bing.com/images/create">Bing</a> image creator</span>
    </div>
 
    <script>
        // This will automatically apply highlight.js to all <pre><code> blocks
        document.addEventListener('DOMContentLoaded', function () {

        let yearPicker = document.querySelector('#year-picker select')
        if (yearPicker) {
            yearPicker.addEventListener('change', function () {
                window.location = this.value;
            });
        }

          // Automatically highlight all <code> blocks inside <pre>
          hljs.highlightAll();
        });
    </script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-P8Y1BWSSF3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-P8Y1BWSSF3');
    </script>
</body>

</html>